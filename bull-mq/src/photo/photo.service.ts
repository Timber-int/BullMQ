import { Injectable } from '@nestjs/common';
import { InjectQueue } from '@nestjs/bull';
import { Queue } from 'bull';

@Injectable()
export class PhotoService {
  constructor(@InjectQueue('photo') private photoQueue: Queue) {}

  async processPhoto(filePath: string) {
    const job = await this.photoQueue.add(
      'analyze_photo', // –ù–∞–∑–≤–∞ –æ–±—Ä–æ–±–Ω–∏–∫–∞ –∑–∞–¥–∞—á—ñ
      { filePath }, // –î–∞–Ω—ñ –∑–∞–¥–∞—á—ñ
      {
        // --- üîß –û—Å–Ω–æ–≤–Ω—ñ –æ–ø—Ü—ñ—ó –∑–∞–¥–∞—á—ñ ---

        // priority: 1, // –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞—á—ñ: —á–∏–º –º–µ–Ω—à–µ —á–∏—Å–ª–æ ‚Äî —Ç–∏–º —Ä–∞–Ω—ñ—à–µ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–æ (1 ‚Äî –Ω–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)
        //
        delay: 5000, // –ó–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∑–∞–¥–∞—á—ñ (—É –º—Å), —Ç—É—Ç 5 —Å–µ–∫—É–Ω–¥
        //
        // attempts: 5, // –°–∫—ñ–ª—å–∫–∏ —Ä–∞–∑—ñ–≤ –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ –∑–∞–¥–∞—á—É –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
        //
        // backoff: 1000, // –ß–∞—Å (—É –º—Å) –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—É–ø–Ω–æ—é —Å–ø—Ä–æ–±–æ—é (–∞–±–æ –º–æ–∂–Ω–∞ —è–∫ –æ–±'—î–∫—Ç: { type: 'exponential', delay: 3000 })
        //
        // lifo: true, // –Ø–∫—â–æ true ‚Äî –æ—Å—Ç–∞–Ω–Ω—ñ –∑–∞–¥–∞—á—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø–µ—Ä—à–∏–º–∏ (LIFO, —è–∫ —Å—Ç–µ–∫), —ñ–Ω–∞–∫—à–µ FIFO
        //
        // timeout: 10000, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–¥–∞—á—ñ (—É –º—Å), –ø—ñ—Å–ª—è —á–æ–≥–æ –∑–∞–¥–∞—á–∞ –≤–≤–∞–∂–∞—î—Ç—å—Å—è –Ω–µ–≤–¥–∞–ª–æ—é
        //
        // jobId: 1, // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á—ñ ‚Äî –∑–∞–ø–æ–±—ñ–≥–∞—î –¥—É–±–ª—é–≤–∞–Ω–Ω—é (–º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ undefined, —Ç–æ–¥—ñ –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
        //
        // removeOnComplete: 5, // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–¥–∞—á—É –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (true/false –∞–±–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–¥–∞—á –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è)
        //
        // removeOnFail: 5, // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—ñ—Å–ª—è –ø–æ–º–∏–ª–∫–∏ (true/false –∞–±–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–¥–∞—á –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è)

        // --- üïë –ü–æ–≤—Ç–æ—Ä –∑–∞–¥–∞—á—ñ ---
        // repeat: {
        //   every: 60000, // –ü–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –∫–æ–∂–Ω—ñ 60 —Å–µ–∫—É–Ω–¥ (—è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ cron)
        //   limit: 10, // –û–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–æ–≤—Ç–æ—Ä—ñ–≤
        //   cron: '*/2 * * * *', // –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ cron: –∫–æ–∂–Ω—ñ 2 —Ö–≤–∏–ª–∏–Ω–∏
        // },

        // --- üß© –Ü–Ω—à—ñ –æ–ø—Ü—ñ—ó ---

        // stackTraceLimit: 10, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞—Å—É–≤–∞–Ω—å –ø–æ–º–∏–ª–æ–∫, —è–∫—ñ –±—É–¥—É—Ç—å –∑–±–µ—Ä—ñ–≥–∞—Ç–∏—Å—å
        // timestamp: Date.now(), // –ú—ñ—Ç–∫–∞ —á–∞—Å—É –¥–ª—è –∑–∞–¥–∞—á—ñ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äî –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å)
        // attemptsMade: 0, // –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–∏—Ö —Å–ø—Ä–æ–± (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–æ—é)
        // repeatJobKey: 'some-key', // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á –¥–ª—è –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∏—Ö –∑–∞–¥–∞—á (–¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤)
        // groupKey: 'user:123', // –î–ª—è –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –∑–∞–¥–∞—á (BullMQ)
      },
    );

    console.log(`üì∏ –§–æ—Ç–æ –¥–æ–¥–∞–Ω–æ –≤ —á–µ—Ä–≥—É:`, job.id);
  }
}
